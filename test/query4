CREATE TABLE PART (
	P_PARTKEY INTEGER PRIMARY KEY, 
	P_NAME STRING, 
	P_MFGR STRING, 
	P_BRAND STRING, 
	P_TYPE STRING, 
	P_SIZE INTEGER, 
	P_CONTAINER STRING, 
	P_RETAILPRICE DOUBLE, 
	P_COMMENT STRING, 
	PRIMARY KEY (P_PARTKEY)
);


CREATE TABLE SUPPLIER (
	S_SUPPKEY INTEGER PRIMARY KEY, 
	S_NAME STRING, 
	S_ADDRESS STRING, 
	S_NATIONKEY INTEGER REFERENCES NATION, 
	S_PHONE STRING, 
	S_ACCTBAL DOUBLE, 
	S_COMMENT STRING, 
	PRIMARY KEY (S_SUPPKEY), 
	INDEX IDX(S_NATIONKEY)
);


CREATE TABLE PARTSUPP (
	PS_PARTKEY INTEGER REFERENCES PART, 
	PS_SUPPKEY INTEGER REFERENCES SUPPLIER, 
	PS_AVAILQTY INTEGER, 
	PS_SUPPLYCOST DOUBLE, 
	PS_COMMENT STRING, 
	INDEX IDX(PS_PARTKEY,PS_SUPPKEY)
);


CREATE TABLE CUSTOMER (
	C_CUSTKEY INTEGER PRIMARY KEY, 
	C_NAME STRING, 
	C_ADDRESS STRING, 
	C_NATIONKEY INTEGER REFERENCES NATION, 
	C_PHONE STRING, 
	C_ACCTBAL DOUBLE, 
	C_MKTSEGMENT STRING, 
	C_COMMENT STRING, 
	PRIMARY KEY (C_CUSTKEY), 
	INDEX IDX(C_NATIONKEY)
);


CREATE TABLE ORDERS (
	O_ORDERKEY INTEGER PRIMARY KEY, 
	O_CUSTKEY INTEGER REFERENCES CUSTOMER, 
	O_ORDERSTATUS STRING, 
	O_TOTALPRICE DOUBLE, 
	O_ORDERDATE DATE, 
	O_ORDERPRIORITY STRING, 
	O_CLERK STRING, 
	O_SHIPPRIORITY INTEGER, 
	O_COMMENT STRING, 
	PRIMARY KEY (O_ORDERKEY), 
	INDEX IDX(O_CUSTKEY)
);


CREATE TABLE LINEITEM (
	L_ORDERKEY INTEGER REFERENCES ORDERS, 
	L_PARTKEY INTEGER REFERENCES PART, 
	L_SUPPKEY INTEGER REFERENCES SUPPLIER, 
	L_LINENUMBER INTEGER, 
	L_QUANTITY DOUBLE, 
	L_EXTENDEDPRICE DOUBLE, 
	L_DISCOUNT DOUBLE, 
	L_TAX DOUBLE, 
	L_RETURNFLAG STRING, 
	L_LINESTATUS STRING, 
	L_SHIPDATE DATE, 
	L_COMMITDATE DATE, 
	L_RECEIPTDATE DATE, 
	L_SHIPINSTRUCT STRING, 
	L_SHIPMODE STRING, 
	L_COMMENT STRING, 
	PRIMARY KEY (L_ORDERKEY, L_LINENUMBER), 
	INDEX IDX(L_ORDERKEY,L_PARTKEY,L_SUPPKEY)
);


CREATE TABLE NATION(
	N_NATIONKEY INTEGER PRIMARY KEY, 
	N_NAME STRING, 
	N_REGIONKEY INTEGER REFERENCES REGION, 
	N_COMMENT STRING, 
	PRIMARY KEY (N_NATIONKEY), 
	INDEX IDX(N_REGIONKEY)
);


CREATE TABLE REGION(
	R_REGIONKEY INTEGER PRIMARY KEY, 
	R_NAME STRING, 
	R_COMMENT STRING, 
	PRIMARY KEY (R_REGIONKEY)
);



SELECT SUM(LINEITEM.L_EXTENDEDPRICE+ (1 + LINEITEM.L_DISCOUNT)) AS REVENUE 
FROM LINEITEM, ORDERS 
WHERE (LINEITEM.L_DISCOUNT < 0.07 OR LINEITEM.L_QUANTITY < 26) 
	AND LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY 
	AND LINEITEM.L_RETURNFLAG = 'R';


SELECT  L.L_SHIPDATE, L.L_COMMITDATE, 
	L.L_RECEIPTDATE, PU.PS_SUPPLYCOST 
FROM LINEITEM L, PARTSUPP PU 
WHERE PU.PS_PARTKEY = L.L_PARTKEY 
	AND PU.PS_SUPPKEY = L.L_SUPPKEY 
	AND PU.PS_SUPPLYCOST < 3 
	AND PU.PS_SUPPKEY < 5000 
	AND L.L_ORDERKEY < 10000 
LIMIT 100;


SELECT  L_LINESTATUS, 
	SUM(L_EXTENDEDPRICE+ (1 - L_DISCOUNT)) AS REVENUE 
FROM LINEITEM, PART 
WHERE L_QUANTITY >= 2 
	AND L_QUANTITY <= 6 
	AND P_SIZE > 1 
	AND P_SIZE < 6 
	AND L_SHIPINSTRUCT = 'DELIVER IN PERSON' 
	AND P_PARTKEY = L_PARTKEY 
GROUP BY L_LINESTATUS 
ORDER BY L_LINESTATUS;


SELECT  LINEITEM.L_ORDERKEY, 
	SUM(LINEITEM.L_EXTENDEDPRICE*(1-LINEITEM.L_DISCOUNT)) AS REVENUE, 
	ORDERS.O_ORDERDATE, 
	ORDERS.O_SHIPPRIORITY 
FROM CUSTOMER, ORDERS, LINEITEM 
WHERE CUSTOMER.C_MKTSEGMENT = 'BUILDING' 
	AND CUSTOMER.C_CUSTKEY = ORDERS.O_CUSTKEY 
	AND LINEITEM.L_ORDERKEY = ORDERS.O_ORDERKEY 
	AND (LINEITEM.L_DISCOUNT < 0.08 OR LINEITEM.L_QUANTITY < 34) 
GROUP BY ORDERS.O_ORDERDATE, ORDERS.O_SHIPPRIORITY, LINEITEM.L_ORDERKEY 
ORDER BY REVENUE DESC, ORDERS.O_ORDERDATE 
LIMIT 100;

39|173345.6777|1996-09-20|0
450|149657.92599999998|1995-03-05|0
134|149480.56579999998|1992-05-01|0
420|149332.25699999998|1995-10-31|0
486|144716.85859999998|1996-03-11|0
229|138893.08049999998|1993-12-29|0
3|117920.38740000002|1993-10-14|0
579|117041.11579999999|1998-03-11|0
132|112581.9216|1993-06-11|0
549|104934.14379999999|1992-07-13|0
548|94883.7552|1994-09-21|0
198|94657.9885|1998-01-02|0
165|92789.8884|1993-01-30|0
231|87020.5828|1994-09-29|0
7|86976.6656|1996-01-10|0
195|82397.38949999999|1993-12-28|0
517|81258.30119999999|1997-04-07|0
323|76132.52459999999|1994-03-26|0
578|65177.812999999995|1997-01-10|0
131|50493.2896|1994-06-08|0
101|50031.1464|1996-03-17|0
193|45389.7722|1993-08-08|0
551|43788.728|1995-05-30|0
227|43241.98239999999|1995-11-10|0
581|39395.9544|1997-02-23|0
483|37641.4176|1995-07-11|0
577|34178.5628|1994-12-19|0
294|29761.86|1993-07-16|0
454|22968.561599999997|1995-12-27|0
321|18731.79|1993-03-21|0
391|13021.8088|1994-11-17|0
257|6963.480999999999|1998-03-28|0
421|1013.4474000000001|1992-02-22|0

SELECT  S_SUPPKEY, 
	L_RETURNFLAG, 
	L_LINESTATUS, 
	SUM(L_QUANTITY) AS SUM_QTY, 
	SUM(L_EXTENDEDPRICE) AS SUM_BASE_PRICE, 
	SUM(L_EXTENDEDPRICE*(1-L_DISCOUNT)) AS SUM_DISC_PRICE, 
	SUM(L_EXTENDEDPRICE*(1-L_DISCOUNT)*(1+L_TAX)) AS SUM_CHARGE, 
	AVG(L_QUANTITY) AS AVG_QTY, 
	AVG(L_EXTENDEDPRICE) AS AVG_PRICE, 
	AVG(L_DISCOUNT) AS AVG_DISC 
FROM LINEITEM, SUPPLIER 
WHERE L_SUPPKEY = S_SUPPKEY 
	AND L_QUANTITY > 25 
GROUP BY L_RETURNFLAG, L_LINESTATUS,S_SUPPKEY 
ORDER BY L_RETURNFLAG, L_LINESTATUS, S_SUPPKEY 
LIMIT 300;
